# 预测功能产品路线图

文档类型: 产品规划  
创建时间: 2025-11-25  
状态: MVP -> 优化 -> 高级

---

## 产品愿景

打造准确率60%+、可解释性强、实时更新的足球比赛预测系统。

---

## 三阶段路线图

### 🚀 Phase 1: MVP（当前阶段）

**目标**: 快速验证产品价值

**核心功能**:
- [x] 规则预测器（准确率52-55%）
- [x] Agent集成接口
- [x] 基础特征提取（23个特征）
- [ ] 端到端测试
- [ ] 用户反馈收集

**技术方案**:
```python
# 使用简单规则预测
class SimpleRuleBasedPredictor:
    """
    基于排名、状态、主场优势的规则预测
    准确率: 52-55%
    """
    def predict_single(self, features):
        # 规则逻辑
        if rank_diff > 5:
            home_prob += 0.2
        if home_recent_wins >= 3:
            home_prob += 0.1
        # ...
```

**交付标准**:
- ✅ 预测功能可用
- ✅ 准确率 > 50%
- ✅ 响应时间 < 2秒
- ⏳ 集成到Agent
- ⏳ 用户可以查询

**时间**: 1-2天

---

### 📈 Phase 2: 优化（下周）

**目标**: 提升准确率到60%

**核心优化**:
1. **动态积分榜**（P0）
   - 从历史比赛实时计算排名
   - 解决时间错配问题
   - 预期提升: +5-8%

2. **历史数据补充**（P1）
   - 摄取2023赛季数据
   - 增加训练样本到1500+
   - 预期提升: +3-5%

3. **XGBoost模型训练**（P1）
   - 使用优化后的特征
   - 超参数调优
   - 预期准确率: 58-62%

**技术方案**:
```python
# 动态积分榜计算器
class DynamicStandingsCalculator:
    async def calculate_standings_at_date(
        self, league_id, date, season
    ):
        """根据历史比赛计算截至某日期的积分榜"""
        matches = await get_finished_matches_before(date)
        # 实时计算积分、排名
        return standings

# 特征提取器使用动态积分榜
extractor.use_dynamic_standings = True
```

**交付标准**:
- ⏳ 准确率 > 58%
- ⏳ 动态积分榜可用
- ⏳ 历史数据完整
- ⏳ 模型可持续优化

**时间**: 3-5天

---

### 🎯 Phase 3: 高级功能（下月）

**目标**: 达到行业领先水平

**核心功能**:
1. **多模型集成**
   - XGBoost + LightGBM + 规则
   - 投票或加权平均
   - 预期准确率: 62-65%

2. **高级特征**
   - 球员数据（伤病、状态）
   - 赛程密度
   - 历史对阵战术分析
   - 天气、裁判等外部因素

3. **预测解释**
   - SHAP值分析
   - 为每个预测生成解释
   - 增强用户信任

4. **实时更新**
   - 比赛前实时更新特征
   - 阵容、伤病实时调整
   - 预测概率动态变化

**技术方案**:
```python
# 模型集成
class EnsemblePredictor:
    def __init__(self):
        self.models = [
            XGBoostPredictor(weight=0.4),
            LightGBMPredictor(weight=0.3),
            RuleBasedPredictor(weight=0.3)
        ]
    
    def predict(self, features):
        # 加权平均
        predictions = [m.predict(features) * m.weight 
                      for m in self.models]
        return weighted_average(predictions)

# 预测解释
explainer = shap.TreeExplainer(model)
shap_values = explainer.shap_values(features)
explanation = generate_explanation(shap_values)
```

**交付标准**:
- ⏳ 准确率 > 62%
- ⏳ 预测可解释
- ⏳ 支持实时更新
- ⏳ 用户满意度 > 80%

**时间**: 2-3周

---

## 技术架构

### 当前架构（MVP）

```
用户查询 -> Agent -> PredictionTool -> RuleBasedPredictor -> 结果
                            |
                            v
                    FeatureExtractor (静态积分榜)
                            |
                            v
                        Database
```

### 目标架构（Phase 3）

```
用户查询 -> Agent -> PredictionTool
                         |
                         v
                  EnsemblePredictor
                    /      |      \
                   /       |       \
             XGBoost  LightGBM  Rules
                   \       |       /
                    \      |      /
                     \     |     /
                  FeatureExtractor (动态)
                    /      |      \
                   /       |       \
           DynamicStandings  历史数据  实时数据
                   \       |       /
                    \      |      /
                     \     |     /
                      Database + API
```

**设计原则**:
1. **模块化**: 各组件独立，易于替换
2. **可扩展**: 新增模型或特征无需大改
3. **向后兼容**: 升级不影响已有功能
4. **性能优先**: 缓存、异步、批处理

---

## 数据需求

### Phase 1 (当前)
- ✅ 2024赛季比赛数据（582场）
- ✅ 2024赛季积分榜（5个联赛）
- ✅ 球队基础信息

### Phase 2 (下周)
- ⏳ 2023赛季比赛数据（~1500场）
- ⏳ 2023赛季积分榜
- ⏳ 动态积分榜计算逻辑

### Phase 3 (下月)
- ⏳ 2022赛季数据
- ⏳ 球员数据（伤病、转会）
- ⏳ 天气、裁判等外部数据
- ⏳ 赛程密度数据

---

## 性能指标

### 准确率目标

| 阶段 | 主胜 | 平局 | 客胜 | 总体 |
|------|------|------|------|------|
| Phase 1 | 55% | 35% | 55% | 52% |
| Phase 2 | 65% | 40% | 60% | 58% |
| Phase 3 | 70% | 45% 65% | 62% |

**说明**: 平局最难预测，这是行业常态

### 响应时间目标

| 操作 | Phase 1 | Phase 2 | Phase 3 |
|------|---------|---------|---------|
| 单场预测 | <2s | <1s | <500ms |
| 批量预测 | N/A | <5s | <3s |
| 特征提取 | <1s | <500ms | <200ms |

### 可靠性目标

| 指标 | Phase 1 | Phase 2 | Phase 3 |
|------|---------|---------|---------|
| 可用率 | 95% | 99% | 99.9% |
| 错误率 | <5% | <2% | <1% |
| 缓存命中 | N/A | 60% | 80% |

---

## 优化清单

### 数据层优化

- [ ] 实现动态积分榜计算
- [ ] 摄取多赛季历史数据
- [ ] 添加球员数据表
- [ ] 实现数据缓存机制
- [ ] 建立特征存储（Feature Store）

### 模型层优化

- [ ] 训练XGBoost模型（动态积分榜）
- [ ] 训练LightGBM模型
- [ ] 实现模型集成
- [ ] 超参数自动调优
- [ ] 在线学习机制

### 特征工程优化

- [ ] 增加球员相关特征（10+）
- [ ] 增加赛程密度特征
- [ ] 增加对阵战术特征
- [ ] 特征选择和降维
- [ ] 特征重要性分析

### 系统优化

- [ ] 预测结果缓存
- [ ] 特征计算缓存
- [ ] 异步批处理
- [ ] 性能监控
- [ ] A/B测试框架

---

## 风险管理

### 数据风险

| 风险 | 影响 | 应对 |
|------|------|------|
| 历史数据不足 | 模型准确率低 | 使用规则预测器兜底 |
| API限流 | 数据更新慢 | 实现本地缓存 |
| 数据质量差 | 特征不准 | 数据质量监控 |

### 模型风险

| 风险 | 影响 | 应对 |
|------|------|------|
| 准确率不达标 | 用户不信任 | 明确告知准确率 |
| 过拟合 | 泛化能力差 | 交叉验证 |
| 模型老化 | 准确率下降 | 定期重训练 |

### 产品风险

| 风险 | 影响 | 应对 |
|------|------|------|
| 用户期望过高 | 失望 | 明确准确率限制 |
| 预测结果误导 | 信任危机 | 增加免责声明 |
| 竞品压力 | 市场份额 | 差异化功能 |

---

## 成本估算

### 开发成本

| 阶段 | 开发时间 | 人力成本 |
|------|----------|----------|
| Phase 1 | 1-2天 | 低 |
| Phase 2 | 3-5天 | 中 |
| Phase 3 | 2-3周 | 高 |

### 运营成本

| 项目 | Phase 1 | Phase 2 | Phase 3 |
|------|---------|---------|---------|
| API费用 | $0-50/月 | $50-100/月 | $100-200/月 |
| 计算资源 | 低 | 中 | 高 |
| 存储 | <1GB | <5GB | <20GB |

---

## 竞品对比

### 行业标准

| 公司 | 准确率 | 特点 |
|------|--------|------|
| 专业博彩公司 | 65-70% | 海量数据，专业团队 |
| FiveThirtyEight | 60-65% | 统计模型，公开透明 |
| 简单预测网站 | 50-55% | 规则或简单模型 |

**我们的定位**: 
- Phase 1: 与简单网站相当（52%）
- Phase 2: 接近FiveThirtyEight（58-62%）
- Phase 3: 接近专业水平（62-65%）

---

## 用户反馈计划

### Phase 1 测试

**目标用户**: 10-20个内测用户

**收集指标**:
- 预测准确率（用户主观）
- 响应速度满意度
- 功能使用频率
- 改进建议

### Phase 2 测试

**目标用户**: 50-100个用户

**A/B测试**:
- 规则预测 vs ML预测
- 不同特征组合
- 不同展示方式

### Phase 3 上线

**目标用户**: 500+用户

**持续优化**:
- 用户行为分析
- 预测准确率监控
- 功能迭代

---

## 里程碑

### Week 1 (本周)
- [x] 完成规则预测器
- [x] 完成特征提取框架
- [ ] 集成到Agent
- [ ] 端到端测试

### Week 2 (下周)
- [ ] 实现动态积分榜
- [ ] 摄取历史数据
- [ ] 训练ML模型
- [ ] 准确率 > 58%

### Week 3-4 (下下周)
- [ ] 球员数据摄取
- [ ] 高级特征工程
- [ ] 模型集成
- [ ] 预测解释

### Month 2
- [ ] 实时更新机制
- [ ] 性能优化
- [ ] 用户测试
- [ ] 准确率 > 62%

---

## 决策记录

### 2025-11-25: Phase 1使用规则预测器

**背景**: ML模型准确率仅47.86%，不如规则预测器

**决策**: MVP阶段使用规则预测器（52-55%）

**理由**:
1. 立即可用，无需等待
2. 准确率更高
3. 可解释性强
4. 架构支持未来升级

**影响**:
- 短期：功能快速上线
- 中期：需要优化到ML模型
- 长期：按路线图逐步升级

---

## 总结

### 当前阶段（MVP）

**目标**: 快速验证产品价值
**方案**: 规则预测器 + 基础特征
**准确率**: 52-55%
**时间**: 1-2天

### 优化路径

1. **Phase 2**: 动态积分榜 + 历史数据 -> 58-62%
2. **Phase 3**: 多模型集成 + 高级特征 -> 62-65%

### 长期愿景

打造准确率60%+、可解释性强、实时更新的预测系统，成为体育AI领域的标杆产品。

---

**下一步**: 集成预测功能到Agent，完成端到端流程，开始收集用户反馈。

