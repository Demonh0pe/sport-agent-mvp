# Sport Agent 项目初期计划（MVP 阶段）

## 核心方向
1. **比赛分析解读**：以结构化/可解释方式输出赛前、赛中、赛后的洞察。
2. **比赛预测**：构建多层预测体系（胜平负、比分、事件、LLM 增强）。

---

## 1. 比赛分析解读模块

### 1.1 统计数据分析
- 球队维度：进/失球、控球率、射门/射正、传控效率、xG/xGA。
- 球员维度：进球、助攻、传球成功率、抢断、犯规、黄红牌等。
- 团队状态：近 N 场战绩、连胜/连败、主客场区分、体能/赛程密度指标。

### 1.2 历史对比分析
- H2H：最近 5/10 场交锋胜平负、净胜球、主客场差异、关键事件统计。
- 主客场对比：主场 vs 客场的进攻/防守效率差异。
- 核心球员对比：绝对/相对效率、受伤停影响、替补梯队深度。

### 1.3 战术分析
- 战术风格分类：控球、长传反击、高位逼抢等指标（基于位置数据或事件标签）。
- 阵型/教练策略：近几场常用阵型、阵型切换频率、换人策略。

### 1.4 实时数据分析（赛中）
- 实时控球率、射门质量、关键事件（进球、牌、伤病、换人）。
- 触发阈值：当实时数据偏离赛前预期时提醒 Agent/用户。

### 1.5 赛后复盘
- 比赛时间线：进球/牌/换人事件回放。
- 指标回顾：预期数据 vs 实际结果，关键转折点解析。

交付：为上述分析方向设计 API/工具接口 + 特征脚本，Agent 可按需调用。

---

## 2. 比赛预测模块

### 2.1 胜平负概率预测
- 机器学习：XGBoost/LightGBM，特征来自球队/球员/战术/资讯。
- Elo & 统计基线：为冷启动/模型异常提供兜底，并用于解释。

### 2.2 比分预测
- Poisson/双 Poisson：根据进球均值估计比分分布。
- ML 区间预测：输出常见比分段（0-1, 2-3, 4+）。

### 2.3 特殊事件预测
- 进球数区间、角球、黄牌、点球概率。
- 关键球员相关事件（进球、助攻、红牌）。

### 2.4 LLM 增强预测
- 结合新闻、舆论、专家观点形成定性因子。
- 上下文理解：杯赛淘汰、德比、保级/争冠压力等情绪因素。
- 多模态融合：若引入视频/图像信号，可做战术/状态补充。
- Chain-of-Thought：LLM 生成推理链辅助解释与置信表达。

---

## 3. 初期实施计划（修订版 v2.0）

> 以 12 周为周期，拆分为 4 个阶段。聚焦“先解决实体/数据死穴，再构建 Agent 与预测基线，随后接入真实数据并完成产品化”。

### 3.1 阶段 1：地基与数据管线（第 1-3 周）
**目标：** 跑通 “数据 → 存储 → 接口” 的最小闭环，优先解决实体对齐。

1. **基础设施与 CI/CD（前置）**
   - Monorepo 初始化：FastAPI 服务、Airflow 数据管线骨架。
   - CI/CD：GitHub Actions 触发 lint/测试/Docker 构建，尽早锁定依赖。
2. **核心 Schema 与实体对齐（关键）**
   - 根据 `sport-agent-tech-design.md` 完成 `Match/Team/Player/Odds/News` 等表结构。
   - 落地 Entity Resolution 服务：别名库 + 规则/Embedding 匹配 + 人工校正流程，统一 *Man City* / *Manchester City* / *曼城* 等 ID。
3. **资讯与数据接入**
   - 编写基础爬虫或公开 API Client，将原始数据落地到 S3/OSS Raw 层，并记录源头与时间戳。

**完成定义 DoD：** Schema 版本入库、实体映射接口可用、至少一个公开数据源完成端到端入湖、CI/CD 成功跑通。

### 3.2 阶段 2：核心 Agent 与预测基线（第 4-6 周）
**目标：** Agent 能理解意图并调用 Mock 工具；预测模型形成可部署的 Baseline。

1. **ReAct Agent 原型（Mock 模式）**
   - Planner：实现意图分类（预测/资讯/混合），按照 `agent-design.md` 选择工具。
   - Tool 接口：使用 Pydantic 定义输入输出，先返回 Mock 数据保持逻辑完整。
   - 记忆模块：接入 Redis，管理短期上下文。
2. **预测模型基线**
   - 特征工程：借助 DuckDB/Pandas 生成 `feature_store.match_features`，包含 last5、H2H、赛程密度等。
   - Baseline 训练：训练 XGBoost 胜平负模型 + Poisson 比分基线，使用 MLflow 记录并通过 BentoML 暴露推理服务。

**完成定义 DoD：** `/api/v1/agent/query` 可串联 Mock 工具，`PredictionService` 可读取特征并调用 baseline 模型，模型版本登记在 Model Registry。

### 3.3 阶段 3：真实集成与评估体系（第 7-9 周）
**目标：** 用真实数据替换 Mock，Agent 输出“懂球”的回答，并建立质量评估。

1. **全链路集成**
   - Agent 工具接入真实 `Prediction API`、`News Retrieval API`、统计/战术分析接口。
   - 引入向量数据库（FAISS/PgVector）构建 RAG，支持资讯的语义检索与引用。
2. **质量评估体系**
   - 模型：上线 LogLoss、Brier Score、联赛分组表现的监控板。
   - Agent：构建自动化问答测试集 + LLM-as-a-Judge，重点评估 Faithfulness，防止幻觉。

**完成定义 DoD：** Agent 返回的内容可溯源到具体工具输出；监控 Dashboard 可查看模型/Agent 关键指标；RAG 能检索资讯并标注引用。

### 3.4 阶段 4：产品化与高可用（第 10-12 周）
**目标：** 优化用户体验，完成灰度上线。

1. **性能与体验**
   - Streaming：API 支持 SSE，提升感知速度。
   - 缓存：Redis 缓存高频查询（如热门球队下一场），TTL 5 分钟，可配置失效策略。
2. **灰度上线**
   - 建立 Staging 环境，接入内部/社群用户测试。
   - 制定回滚策略、版本开关与 SLA，打通反馈闭环。

**完成定义 DoD：** 流式响应可用、热点缓存命中率达标、Staging 用户完成首轮试用并收集反馈，具备可控的灰度流程。

---

## 4. 风险与应对
- **数据延迟/质量**：多源备份 + 实时 SLA 监控 + Entity Resolution 审计面板。
- **模型失效**：Elo/规则兜底、自动回滚、Shadow 流量对比。
- **LLM 可靠性**：Guardrail、事实核验、LLM-as-a-Judge 回归测试。
- **资源优先级**：阶段 1/2 必须完成，阶段 3/4 可根据带宽调节范围但需保持最小可行能力。
